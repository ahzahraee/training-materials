\documentclass[a4wide]{book}

\usepackage{labs}
\usepackage{listings}
\usepackage{lstautogobble}
\usepackage{verbatim}
\usepackage{moreverb}
\usepackage{xcolor}
\usepackage{mdframed}

% Custom bootlin commands

\definecolor{mygray}{rgb}{0.8,0.8,0.8}

\lstset{
  autogobble,
  language=[LaTeX]TeX,
  basicstyle=\ttfamily,
  breaklines=true,
  escapechar={\%},
  belowskip=0pt,
  columns=fullflexible
}

% environment for long lines of code/cmd input with backslash at end of line 
\lstnewenvironment{terminalinput}
{
  \lstset{
  prebreak=\textbackslash,
  alsoletter={()[].=:-},
}}{}

\surroundwithmdframed[innerleftmargin=1pt,innerrightmargin=1pt,skipabove=\topskip,skipbelow=\topskip,linewidth=0pt,innertopmargin=1pt, innerbottommargin=1pt, backgroundcolor=lightgray!20]{terminalinput}

\def\clinput{\lstinline[basicstyle=\ttfamily]}

\newcommand\ubootcli[1]{\colorbox{mygray}{\lstinline[#1]}}

\def\inlinecode#1{%
    \colorbox{lightgray!15}{\lstinline{#1}}%
}

\newcommand\bashcmd[1]{\begin{mdframed}[innerleftmargin=1pt,innerrightmargin=1pt,skipabove=\topskip,skipbelow=\topskip,linewidth=0pt,innertopmargin=4pt, innerbottommargin=4pt,backgroundcolor=lightgray!20]{\lstinline{#1}}\end{mdframed}}

\newcommand\ubootcmd[1]{\begin{mdframed}[innerleftmargin=1pt,innerrightmargin=1pt,skipabove=\topskip,skipbelow=\topskip,linewidth=0pt,innertopmargin=4pt, innerbottommargin=4pt,backgroundcolor=blue!5]{\lstinline[]{#1}}\end{mdframed}}

% environment for long lines of u-boot cmd input without backslash at end of line 
\lstnewenvironment{ubootinput}{\lstset{
  alsoletter={()[].=:-},
}}{}

\surroundwithmdframed[innerleftmargin=1pt,innerrightmargin=1pt,skipabove=\topskip,skipbelow=\topskip,linewidth=0pt,innertopmargin=1pt, innerbottommargin=1pt, backgroundcolor=blue!5]{ubootinput}

% following lines aligned at left margin
\lstnewenvironment{terminaloutput}{\lstset{
  breakautoindent=false,
  alsoletter={()[].=:-},
  breakindent=0pt,
}}{}

%\surroundwithmdframed[innerleftmargin=1pt,innerrightmargin=1pt,skipabove=\topskip,skipbelow=\topskip,linewidth=0pt,innertopmargin=1pt, innerbottommargin=1pt, backgroundcolor=blue!5]{terminaloutput}

\newcommand{\sourcecode}[1]{\verbatimtabinput{../#1}{\small (Source code link:
\url{https://raw.githubusercontent.com/bootlin/training-materials/master/#1})}}

\title{\labbooktitle \\
\vspace{0.5cm}
\ifdefstring{\labbooksubtitle}{}{}{\Large \labbooksubtitle \\}
\huge\vspace{1cm} Practical Labs}
\trainingurl{https://bootlin.com/doc/training/__SESSION_NAME__}

\begin{document}
\maketitle

\makeabout

